<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUKU AI - Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø£Ù„ØºØ§Ø² Ø§Ù„Ø°ÙƒÙŠ</title>
    <meta name="description" content="LUKU AI - Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ø£Ù„ØºØ§Ø² ÙˆØ§Ù„Ø£Ù„Ø¹Ø§Ø¨. ØªØ­Ø¯Ù‰ Ù†ÙØ³Ùƒ Ù…Ø¹ Ø£Ù„ØºØ§Ø² ÙÙŠ Ù…Ø®ØªÙ„Ù Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª ÙˆØ§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ§©</text></svg>">
    <style>
        :root {
          --bg: #0b0e14;
          --text: #e5e7eb;
          --muted: #9ca3af;
          --card: #0f131b;
          --border: #1f2430;
          --brand: #22d3ee;
          --user-bubble: #0f172a;
          --bot-bubble: #0d1117;
          --success: #10b981;
          --warning: #f59e0b;
          --error: #ef4444;
          --transition: all 0.3s ease;
        }

        * {
          box-sizing: border-box;
          margin: 0;
          padding: 0;
        }

        body {
          margin: 0;
          font: 16px/1.6 system-ui, sans-serif;
          background: var(--bg);
          color: var(--text);
          transition: var(--transition);
        }

        #app {
          display: grid;
          grid-template-columns: 220px 1fr;
          height: 100vh;
        }

        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ - Ø£ØµØºØ± Ø­Ø¬Ù…Ù‹Ø§ */
        .sidebar {
          display: flex;
          flex-direction: column;
          border-inline-end: 1px solid var(--border);
          background: var(--card);
          transition: var(--transition);
          width: 220px;
        }

        .sidebar-top, .sidebar-bottom {
          padding: 10px;
          border-bottom: 1px solid var(--border);
        }

        .sidebar-bottom {
          border-top: 1px solid var(--border);
          margin-top: auto;
        }

        .history {
          padding: 6px;
          overflow: auto;
          flex: 1;
        }

        .history-empty {
          padding: 10px;
          color: var(--muted);
          text-align: center;
          font-size: 14px;
        }

        .history-item {
          padding: 8px 10px;
          border-radius: 6px;
          cursor: pointer;
          border: 1px solid transparent;
          background: transparent;
          color: var(--text);
          margin-bottom: 6px;
          transition: var(--transition);
          font-size: 14px;
        }

        .history-item:hover {
          background: var(--bg);
          border-color: var(--border);
        }

        .history-item.active {
          border-color: var(--brand);
          background: rgba(34, 211, 238, 0.1);
        }

        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ - Ù…Ø³Ø§Ø­Ø© Ø£ÙƒØ¨Ø± */
        .main {
          display: grid;
          grid-template-rows: auto 1fr auto;
          height: 100vh;
          position: relative;
          width: 100%;
        }

        .chat-header {
          padding: 12px 16px;
          border-bottom: 1px solid var(--border);
          background: var(--card);
          display: flex;
          justify-content: space-between;
          align-items: center;
          transition: var(--transition);
        }

        .chat-title {
          display: flex;
          align-items: center;
          gap: 10px;
        }

        .logo {
          font-size: 22px;
        }

        .name {
          font-weight: 700;
          font-size: 18px;
        }

        .subtitle {
          font-size: 13px;
          color: var(--muted);
          margin-top: 2px;
        }

        .welcome {
          display: grid;
          place-items: center;
          padding: 24px;
          text-align: center;
        }

        .welcome h1 {
          font-size: 2rem;
          margin-bottom: 16px;
        }

        .welcome h1 span {
          color: var(--brand);
        }

        .suggestions {
          display: flex;
          gap: 8px;
          flex-wrap: wrap;
          justify-content: center;
          margin-top: 20px;
          max-width: 600px;
        }

        .chip {
          background: var(--bg);
          border: 1px solid var(--border);
          padding: 10px 16px;
          border-radius: 999px;
          cursor: pointer;
          transition: var(--transition);
          font-size: 14px;
          color: white;
        }

        .chip:hover {
          border-color: var(--brand);
          color: var(--brand);
          transform: translateY(-5px);
        }

        .chip.selected {
          background: var(--brand);
          border-color: var(--brand);
          color: #071318;
        }

        .levels {
          display: flex;
          gap: 8px;
          flex-wrap: wrap;
          justify-content: center;
          margin: 16px 0;
        }

        .levels button {
          background: var(--bg);
          border: 1px solid var(--border);
          padding: 10px 16px;
          border-radius: 999px;
          cursor: pointer;
          transition: var(--transition);
          color: var(--text);
          font-size: 14px;
        }

        .levels button:hover {
          border-color: var(--brand);
          color: var(--brand);
        }

        .levels button.selected {
          background: var(--brand);
          border-color: var(--brand);
          color: #071318;
        }

        /* ØªØ­Ø³ÙŠÙ† Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© - Ù…Ø³Ø§Ø­Ø© Ø£ÙƒØ¨Ø± */
        .chat {
          overflow: auto;
          padding: 16px;
          display: flex;
          flex-direction: column;
          gap: 16px;
          scroll-behavior: smooth;
          width: 100%;
        }

        .msg {
          display: grid;
          grid-template-columns: 36px 1fr;
          gap: 12px;
          align-items: flex-start;
          width: 100%;
          max-width: 900px;
          margin: 0 auto;
          animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }

        .msg .avatar {
          width: 36px;
          height: 36px;
          border-radius: 50%;
          display: grid;
          place-items: center;
          background: var(--bg);
          border: 1px solid var(--border);
          font-size: 16px;
          flex-shrink: 0;
        }

        .msg .bubble {
          background: var(--bot-bubble);
          border: 1px solid var(--border);
          padding: 12px 16px;
          border-radius: 18px;
          white-space: pre-wrap;
          word-wrap: break-word;
          line-height: 1.5;
          max-width: 80%;
        }

        .msg.user {
          direction: ltr;
        }

        .msg.user .bubble {
          background: var(--user-bubble);
          direction: rtl;
        }

        .msg.user .avatar {
          background: var(--brand);
          color: #00111a;
          border: none;
        }

        .typing-indicator {
          display: inline-flex;
          gap: 4px;
          padding: 8px 0;
        }

        .typing-dot {
          width: 6px;
          height: 6px;
          border-radius: 50%;
          background-color: var(--muted);
          animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingAnimation {
          0%, 60%, 100% { transform: translateY(0); }
          30% { transform: translateY(-5px); }
        }

        /* ØªØ­Ø³ÙŠÙ† Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© */
        .composer {
          position: sticky;
          bottom: 0;
          background: linear-gradient(to top, var(--bg) 70%, transparent);
          padding: 16px;
          border-top: 1px solid var(--border);
          transition: var(--transition);
          width: 100%;
        }

        .input-wrap {
          display: grid;
          grid-template-columns: 1fr auto auto;
          gap: 8px;
          align-items: end;
          width: min(900px, 100%);
          margin: 0 auto;
          background: var(--card);
          border: 1px solid var(--border);
          border-radius: 14px;
          padding: 12px;
          transition: var(--transition);
        }

        .input-wrap:focus-within {
          border-color: var(--brand);
          box-shadow: 0 0 0 2px rgba(34, 211, 238, 0.1);
        }

        textarea {
          width: 100%;
          resize: none;
          max-height: 32svh;
          background: transparent;
          color: var(--text);
          border: none;
          outline: none;
          font-size: 15px;
          font-family: inherit;
          line-height: 1.5;
          direction: rtl;
        }

        .controls {
          display: inline-flex;
          gap: 6px;
          align-items: center;
        }

        .btn {
          border: 1px solid var(--border);
          background: var(--bg);
          color: var(--text);
          padding: 8px 12px;
          border-radius: 10px;
          cursor: pointer;
          transition: var(--transition);
          font-family: inherit;
          font-size: 14px;
        }

        .btn:hover {
          border-color: var(--brand);
          color: var(--brand);
        }

        .btn.primary {
          background: var(--brand);
          border-color: var(--brand);
          color: #071318;
        }

        .btn.primary:hover {
          background: #06b6d4;
          border-color: #06b6d4;
          color: #071318;
        }

        .btn.ghost {
          background: transparent;
        }

        .btn.full {
          width: 100%;
        }

        .icon-btn {
          height: 36px;
          width: 36px;
          display: grid;
          place-items: center;
          border-radius: 10px;
          border: 1px solid var(--border);
          background: var(--bg);
          cursor: pointer;
          transition: var(--transition);
        }

        .icon-btn:hover {
          border-color: var(--brand);
          color: var(--brand);
        }

        .tos {
          width: min(900px, 100%);
          margin: 12px auto 0;
          color: var(--muted);
          font-size: 12px;
          text-align: center;
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­ */
        body.theme-light {
          --bg: #f8fafc;
          --text: #1e293b;
          --muted: #64748b;
          --card: #ffffff;
          --border: #e2e8f0;
          --brand: #0ea5e9;
          --user-bubble: #e0f2fe;
          --bot-bubble: #f1f5f9;
        }

        body.theme-light .sidebar {
          border-inline-end: 1px solid var(--border);
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø© */
        @media (max-width: 768px) {
          #app {
            grid-template-columns: 1fr;
          }
       
          .sidebar {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 220px;
            z-index: 100;
            transform: translateX(100%);
            transition: transform 0.3s ease;
          }
       
          .sidebar.open {
            transform: translateX(0);
          }
       
          .sidebar-overlay {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 99;
            display: none;
          }
       
          .sidebar-overlay.open {
            display: block;
          }
       
          .mobile-menu-btn {
            display: block;
            position: fixed;
            top: 16px;
            right: 16px;
            z-index: 101;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
          }
       
          .suggestions, .levels {
            flex-direction: column;
            align-items: stretch;
          }
       
          .input-wrap {
            grid-template-columns: 1fr auto;
          }
       
          .controls {
            grid-column: 1 / -1;
            justify-content: flex-end;
            margin-top: 8px;
          }
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
        .loading {
          opacity: 0.7;
          pointer-events: none;
        }

        .notification {
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          background: var(--card);
          border: 1px solid var(--border);
          border-radius: 8px;
          padding: 12px 16px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
          z-index: 1000;
          display: flex;
          align-items: center;
          gap: 8px;
          animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
          from { opacity: 0; transform: translate(-50%, 20px); }
          to { opacity: 1; transform: translate(-50%, 0); }
        }

        .notification.success {
          border-color: var(--success);
        }

        .notification.error {
          border-color: var(--error);
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù…Ø®ØµØµ */
        .chat::-webkit-scrollbar {
          width: 6px;
        }

        .chat::-webkit-scrollbar-track {
          background: transparent;
        }

        .chat::-webkit-scrollbar-thumb {
          background: var(--border);
          border-radius: 3px;
        }

        .chat::-webkit-scrollbar-thumb:hover {
          background: var(--muted);
        }
    </style>
</head>
<body class="theme-dark">
    <div id="app">
        <!-- Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø© -->
        <button id="mobile-menu-btn" class="mobile-menu-btn" aria-label="ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©">
            <span>â˜°</span>
        </button>
      
        <!-- overlay Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø© -->
        <div id="sidebar-overlay" class="sidebar-overlay"></div>
      
        <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-top">
                <button id="new-chat" class="btn primary full">
                    <span>+</span> Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©
                </button>
            </div>
            <nav class="history" id="history-list">
                <div class="history-empty" id="history-empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø¨Ø¹Ø¯</div>
                <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ù‡Ù†Ø§ Ø¹Ø¨Ø± JavaScript -->
            </nav>
            <div class="sidebar-bottom">
                <button id="toggle-theme" class="btn ghost full">
                    <span id="theme-icon">ğŸŒ™</span> ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¸Ù‡Ø±
                </button>
                <div class="brand">LUKU AI</div>
            </div>
        </aside>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <main class="main">
            <header class="chat-header">
                <div class="chat-title">
                    <span class="logo">ğŸ§©</span>
                    <div>
                        <div class="name">LUKU AI</div>
                        <div class="subtitle">Ù…Ø®ØªØµ ÙÙŠ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ ÙˆØ§Ù„Ø£Ù„ØºØ§Ø² ÙÙ‚Ø·</div>
                    </div>
                </div>
                <button id="clear-chat" class="btn ghost" aria-label="Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©">
                    ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
                </button>
            </header>

            <section id="welcome" class="welcome">
                <h1>Ù…Ø±Ø­Ø¨Ù‹Ø§! ğŸ‘‹ Ø£Ù†Ø§ <span>LUKU AI</span></h1>
                <p class="hint">Ø§Ø®ØªØ± Ù…Ø¬Ø§Ù„ Ø§Ù„Ø£Ù„ØºØ§Ø² Ø£ÙˆÙ„Ø§Ù‹:</p>
                <div class="suggestions">
                    <button class="chip" data-category="Ø¯ÙŠÙ†">ğŸ•Œ Ø¯ÙŠÙ†</button>
                    <button class="chip" data-category="Ø±ÙŠØ§Ø¶Ø©">âš½ Ø±ÙŠØ§Ø¶Ø©</button>
                    <button class="chip" data-category="Ø«Ù‚Ø§ÙØ©">ğŸ“š Ø«Ù‚Ø§ÙØ©</button>
                    <button class="chip" data-category="Ù…Ù†Ø·Ù‚">ğŸ”¢ Ù…Ù†Ø·Ù‚</button>
                    <button class="chip" data-category="ØªØ±ÙÙŠÙ‡">ğŸ­ ØªØ±ÙÙŠÙ‡</button>
                </div>
            </section>

            <section id="chat" class="chat" aria-live="polite"></section>

            <footer class="composer">
                <div class="input-wrap">
                    <textarea id="input" rows="1" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒâ€¦ (Enter Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ / Shift+Enter Ù„Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯)" aria-label="Ø±Ø³Ø§Ù„ØªÙƒ"></textarea>
                    <div class="controls">
                        <button id="copy-last" class="icon-btn" title="Ù†Ø³Ø® Ø¢Ø®Ø± Ø±Ø¯">ğŸ“‹</button>
                        <button id="send" class="btn primary">Ø¥Ø±Ø³Ø§Ù„</button>
                    </div>
                </div>
                <div class="tos">Â© 2025 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© â€” <strong>Luai Kulaib</strong></div>
            </footer>
        </main>
    </div>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
    <div id="notification-area"></div>

    <script>
        // === Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ===
        const state = {
            currentSessionId: null,
            selectedCategory: null,
            selectedLevel: null,
            isWaitingForResponse: false,
            theme: 'dark'
        };

        // === Ø¹Ù†Ø§ØµØ± DOM ===
        const elements = {
            chatBox: document.getElementById("chat"),
            welcomeSection: document.getElementById("welcome"),
            input: document.getElementById("input"),
            sendBtn: document.getElementById("send"),
            suggestions: document.querySelectorAll(".chip"),
            historyList: document.getElementById("history-list"),
            historyEmpty: document.getElementById("history-empty"),
            newChatBtn: document.getElementById("new-chat"),
            toggleThemeBtn: document.getElementById("toggle-theme"),
            themeIcon: document.getElementById("theme-icon"),
            clearChatBtn: document.getElementById("clear-chat"),
            copyLastBtn: document.getElementById("copy-last"),
            mobileMenuBtn: document.getElementById("mobile-menu-btn"),
            sidebar: document.getElementById("sidebar"),
            sidebarOverlay: document.getElementById("sidebar-overlay"),
            notificationArea: document.getElementById("notification-area")
        };

        // === ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ===
        function showNotification(message, type = 'info', duration = 3000) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
          
            let icon = 'ğŸ’¡';
            if (type === 'success') icon = 'âœ…';
            if (type === 'error') icon = 'âŒ';
          
            notification.innerHTML = `
                <span>${icon}</span>
                <span>${message}</span>
            `;
          
            elements.notificationArea.appendChild(notification);
          
            setTimeout(() => {
                notification.remove();
            }, duration);
        }

        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                showNotification('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ù†Øµ', 'error');
            });
        }

        function toggleMobileMenu() {
            elements.sidebar.classList.toggle('open');
            elements.sidebarOverlay.classList.toggle('open');
            document.body.style.overflow = elements.sidebar.classList.contains('open') ? 'hidden' : '';
        }

        // === Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª ÙˆØ§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª ===
        function createNewSession(category = null, level = null) {
            // Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„ØªØ±Ø­ÙŠØ¨
            elements.welcomeSection.style.display = 'none';
          
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯
            state.currentSessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            state.selectedCategory = category;
            state.selectedLevel = level;
          
            // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¬Ø§Ù„ ÙˆØ§Ù„Ù…Ø³ØªÙˆÙ‰
            if (category && level) {
                addMessage(`Ù…Ø±Ø­Ø¨Ù‹Ø§! Ø£Ù†Ø§ LUKU AIØŒ Ø¬Ø§Ù‡Ø² Ù„ØªÙ‚Ø¯ÙŠÙ… Ø£Ù„ØºØ§Ø² ÙÙŠ Ù…Ø¬Ø§Ù„ <strong>${category}</strong> Ø¨Ù…Ø³ØªÙˆÙ‰ ØµØ¹ÙˆØ¨Ø© <strong>${level}</strong>. Ù‡ÙŠØ§ Ù†Ø¨Ø¯Ø£! ğŸ¯`, 'bot');
            } else {
                addMessage(`Ù…Ø±Ø­Ø¨Ù‹Ø§! Ø£Ù†Ø§ LUKU AIØŒ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ù…Ø®ØªØµ ÙÙŠ Ø§Ù„Ø£Ù„ØºØ§Ø² ÙˆØ§Ù„Ø£Ù„Ø¹Ø§Ø¨. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…? ğŸ§©`, 'bot');
            }
          
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ù„Ø³Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
            addSessionToHistory(state.currentSessionId, category, level);
          
            showNotification('ØªÙ… Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©', 'success');
        }

        function addSessionToHistory(sessionId, category, level) {
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª"
            elements.historyEmpty.style.display = 'none';
          
            // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            historyItem.dataset.sessionId = sessionId;
          
            const categoryText = category ? ` (${category})` : '';
            const levelText = level ? ` - ${level}` : '';
          
            historyItem.innerHTML = `
                <div class="history-item-title">Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©${categoryText}</div>
                <div class="history-item-preview">Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø©${levelText}</div>
            `;
          
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø±
            historyItem.addEventListener('click', () => {
                loadSession(sessionId);
            });
          
            elements.historyList.appendChild(historyItem);
        }

        function loadSession(sessionId) {
            showNotification('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©...', 'info');
          
            // Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            clearChat();
          
            // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„
            addMessage('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©...', 'bot');
          
            // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© (ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ù†Ø·Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…)
            setTimeout(() => {
                clearChat();
                addMessage('Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ Ù…Ø¬Ø¯Ø¯Ù‹Ø§! ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…? ğŸ§©', 'bot');
                showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©', 'success');
            }, 1000);
        }

        function clearChat() {
            elements.chatBox.innerHTML = '';
        }

        function clearAllChats() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª? Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.')) {
                elements.historyList.innerHTML = '';
                elements.historyEmpty.style.display = 'block';
                clearChat();
                state.currentSessionId = null;
                elements.welcomeSection.style.display = 'grid';
                showNotification('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª', 'success');
            }
        }

        // === Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ===
        function addMessage(text, sender = 'bot') {
            const msgDiv = document.createElement('div');
            msgDiv.className = `msg ${sender}`;
          
            const avatar = sender === 'bot' ? 'ğŸ§©' : 'ğŸ‘¤';
            const bubbleClass = sender === 'bot' ? '' : 'user';
          
            msgDiv.innerHTML = `
                <div class="avatar">${avatar}</div>
                <div class="bubble ${bubbleClass}">${text}</div>
            `;
          
            elements.chatBox.appendChild(msgDiv);
            elements.chatBox.scrollTop = elements.chatBox.scrollHeight;
        }

        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'msg bot';
            typingDiv.id = 'typing-indicator';
          
            typingDiv.innerHTML = `
                <div class="avatar">ğŸ§©</div>
                <div class="bubble">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
          
            elements.chatBox.appendChild(typingDiv);
            elements.chatBox.scrollTop = elements.chatBox.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // === Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù… ===
        async function sendMessageToServer(message) {
            showTypingIndicator();
            state.isWaitingForResponse = true;
          
            try {
                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        sessionId: state.currentSessionId || 'default',
                        category: state.selectedCategory || '',
                        level: state.selectedLevel || ''
                    })
                });
              
                const data = await response.json();
              
                if (data.error) {
                    throw new Error(data.message);
                }
              
                return data.reply;
              
            } catch (error) {
                console.error('Error communicating with server:', error);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
                return "Ø¹Ø°Ø±Ù‹Ø§ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø®Ø§Ø¯Ù… ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ÙØ° 3000.";
            } finally {
                hideTypingIndicator();
                state.isWaitingForResponse = false;
            }
        }

        // === Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ===
        async function sendMessage() {
            const text = elements.input.value.trim();
            if (!text || state.isWaitingForResponse) return;
          
            // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø¬Ù„Ø³Ø© Ù†Ø´Ø·Ø©ØŒ Ù†Ù†Ø´Ø¦ ÙˆØ§Ø­Ø¯Ø©
            if (!state.currentSessionId) {
                createNewSession();
            }
          
            // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            addMessage(text, 'user');
            elements.input.value = '';
            autoResizeTextarea(elements.input);
          
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø¯
            const reply = await sendMessageToServer(text);
          
            // Ø¥Ø¶Ø§ÙØ© Ø±Ø¯ Ø§Ù„Ø¨ÙˆØª
            addMessage(reply, 'bot');
        }

        // === Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¸Ù‡Ø± ===
        function toggleTheme() {
            if (state.theme === 'dark') {
                document.body.classList.add('theme-light');
                document.body.classList.remove('theme-dark');
                elements.themeIcon.textContent = 'â˜€ï¸';
                state.theme = 'light';
                localStorage.setItem('luku-theme', 'light');
                showNotification('ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­', 'success');
            } else {
                document.body.classList.add('theme-dark');
                document.body.classList.remove('theme-light');
                elements.themeIcon.textContent = 'ğŸŒ™';
                state.theme = 'dark';
                localStorage.setItem('luku-theme', 'dark');
                showNotification('ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†', 'success');
            }
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('luku-theme');
            if (savedTheme === 'light') {
                document.body.classList.add('theme-light');
                document.body.classList.remove('theme-dark');
                elements.themeIcon.textContent = 'â˜€ï¸';
                state.theme = 'light';
            }
        }

        // === ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ===
        function setupEventListeners() {
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
            elements.sendBtn.addEventListener('click', sendMessage);
            elements.input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
              
                // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø­Ø¬Ù… textarea
                if (e.key === 'Enter' && e.shiftKey) {
                    setTimeout(() => autoResizeTextarea(elements.input), 0);
                }
            });
          
            elements.input.addEventListener('input', () => {
                autoResizeTextarea(elements.input);
            });
          
            // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¬Ø§Ù„
            elements.suggestions.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
                    elements.suggestions.forEach(b => b.classList.remove('selected'));
                    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø²Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
                    btn.classList.add('selected');
                  
                    state.selectedCategory = btn.dataset.category;
                  
                    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªÙˆÙ‰
                    elements.welcomeSection.querySelector('.hint').textContent = 'Ø§Ø®ØªØ± Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©:';
                    elements.welcomeSection.querySelector('.suggestions').style.display = 'none';
                  
                    const levelsHtml = `
                        <div class="levels">
                            <button data-level="Ù…Ø¨ØªØ¯Ø¦" class="chip">Ù…Ø¨ØªØ¯Ø¦ ğŸŒ±</button>
                            <button data-level="Ù…ØªÙˆØ³Ø·" class="chip">Ù…ØªÙˆØ³Ø· ğŸ’¡</button>
                            <button data-level="Ø®Ø¨ÙŠØ±" class="chip">Ø®Ø¨ÙŠØ± ğŸ¤¯</button>
                        </div>
                    `;
                  
                    elements.welcomeSection.insertAdjacentHTML('beforeend', levelsHtml);
                  
                    // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„ØµØ¹ÙˆØ¨Ø©
                    document.querySelectorAll('.levels .chip').forEach(levelBtn => {
                        levelBtn.addEventListener('click', () => {
                            // Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª
                            document.querySelectorAll('.levels .chip').forEach(b => b.classList.remove('selected'));
                            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø²Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
                            levelBtn.classList.add('selected');
                          
                            state.selectedLevel = levelBtn.dataset.level;
                            createNewSession(state.selectedCategory, state.selectedLevel);
                        });
                    });
                });
            });
          
            // Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø®Ø±Ù‰
            elements.newChatBtn.addEventListener('click', () => {
                state.selectedCategory = null;
                state.selectedLevel = null;
                elements.welcomeSection.style.display = 'grid';
                elements.welcomeSection.querySelector('.hint').textContent = 'Ø§Ø®ØªØ± Ù…Ø¬Ø§Ù„ Ø§Ù„Ø£Ù„ØºØ§Ø² Ø£ÙˆÙ„Ø§Ù‹:';
                elements.welcomeSection.querySelector('.suggestions').style.display = 'flex';
              
                const levelsSection = elements.welcomeSection.querySelector('.levels');
                if (levelsSection) {
                    levelsSection.remove();
                }
              
                // Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
                elements.suggestions.forEach(b => b.classList.remove('selected'));
              
                clearChat();
                showNotification('ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©', 'success');
            });
          
            elements.toggleThemeBtn.addEventListener('click', toggleTheme);
          
            elements.clearChatBtn.addEventListener('click', () => {
                if (state.currentSessionId) {
                    clearChat();
                    addMessage('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ? ğŸ§©', 'bot');
                    showNotification('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©', 'success');
                } else {
                    showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø© Ù†Ø´Ø·Ø©', 'info');
                }
            });
          
            elements.copyLastBtn.addEventListener('click', () => {
                const lastBotMessage = document.querySelector('.msg.bot:last-child .bubble');
                if (lastBotMessage) {
                    copyToClipboard(lastBotMessage.textContent);
                } else {
                    showNotification('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø¯ Ù„Ù†Ø³Ø®Ù‡', 'info');
                }
            });
          
            // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø©
            elements.mobileMenuBtn.addEventListener('click', toggleMobileMenu);
            elements.sidebarOverlay.addEventListener('click', toggleMobileMenu);
          
            // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
            window.addEventListener('resize', () => {
                if (window.innerWidth <= 768) {
                    elements.mobileMenuBtn.style.display = 'block';
                } else {
                    elements.mobileMenuBtn.style.display = 'none';
                    elements.sidebar.classList.remove('open');
                    elements.sidebarOverlay.classList.remove('open');
                    document.body.style.overflow = '';
                }
            });
        }

        // === ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ===
        function initApp() {
            loadTheme();
            setupEventListeners();
            autoResizeTextarea(elements.input);
          
            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
            const welcomeMessages = [
                "Ù…Ø±Ø­Ø¨Ù‹Ø§! Ø£Ù†Ø§ LUKU AIØŒ Ø¬Ø§Ù‡Ø² Ù„ØªÙ‚Ø¯ÙŠÙ… Ø£Ù„ØºØ§Ø² ÙˆØªØ­Ø¯ÙŠØ§Øª Ù…Ù…ØªØ¹Ø©. ğŸ§©",
                "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ! Ù‡Ù„ Ø£Ù†Øª Ù…Ø³ØªØ¹Ø¯ Ù„Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ù„ØºØ§Ø² Ø§Ù„Ù…Ø«ÙŠØ±Ø©? ğŸ¯",
                "Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ LUKU AI! Ù„Ù†Ø®ØªØ¨Ø± Ø°ÙƒØ§Ø¡Ùƒ Ø§Ù„ÙŠÙˆÙ…. ğŸ’¡"
            ];
          
            const randomIndex = Math.floor(Math.random() * welcomeMessages.length);
            document.querySelector('.welcome h1').innerHTML = `${welcomeMessages[randomIndex]}`;
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯Ù…Ø§ ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>