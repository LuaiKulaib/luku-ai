<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUKU AI - Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø£Ù„ØºØ§Ø² Ø§Ù„Ø°ÙƒÙŠ</title>
    <meta name="description" content="LUKU AI - Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ø£Ù„ØºØ§Ø² ÙˆØ§Ù„Ø£Ù„Ø¹Ø§Ø¨. ØªØ­Ø¯Ù‰ Ù†ÙØ³Ùƒ Ù…Ø¹ Ø£Ù„ØºØ§Ø² ÙÙŠ Ù…Ø®ØªÙ„Ù Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª ÙˆØ§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ§©</text></svg>">
    <style>
        :root {
          --bg: #0b0e14;
          --text: #e5e7eb;
          --muted: #9ca3af;
          --card: #0f131b;
          --border: #1f2430;
          --brand: #22d3ee;
          --user-bubble: #0f172a;
          --bot-bubble: #0d1117;
          --success: #10b981;
          --warning: #f59e0b;
          --error: #ef4444;
          --transition: all 0.3s ease;
          --send-btn-bg: #22d3ee;
          --send-btn-text: #071318;
          --send-btn-hover: #06b6d4;
        }

        * {
          box-sizing: border-box;
          margin: 0;
          padding: 0;
        }

        body {
          margin: 0;
          font: 16px/1.6 system-ui, sans-serif;
          background: var(--bg);
          color: var(--text);
          transition: var(--transition);
        }

        #app {
          display: grid;
          grid-template-columns: 220px 1fr;
          height: 100vh;
        }

        /* === ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ === */
        .sidebar {
          display: flex;
          flex-direction: column;
          border-inline-end: 1px solid var(--border);
          background: var(--card);
          transition: var(--transition);
          width: 220px;
        }

        .sidebar-top, .sidebar-bottom {
          padding: 10px;
          border-bottom: 1px solid var(--border);
        }

        .sidebar-bottom {
          border-top: 1px solid var(--border);
          margin-top: auto;
        }

        .history {
          padding: 6px;
          overflow: auto;
          flex: 1;
        }

        .history-empty {
          padding: 10px;
          color: var(--muted);
          text-align: center;
          font-size: 14px;
        }

        .history-item {
          padding: 8px 10px;
          border-radius: 6px;
          cursor: pointer;
          border: 1px solid transparent;
          background: transparent;
          color: var(--text);
          margin-bottom: 6px;
          transition: var(--transition);
          font-size: 14px;
        }

        .history-item:hover {
          background: var(--bg);
          border-color: var(--border);
        }

        .history-item.active {
          border-color: var(--brand);
          background: rgba(34, 211, 238, 0.1);
        }

        /* === ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ === */
        .main {
          display: grid;
          grid-template-rows: auto 1fr auto;
          height: 100vh;
          position: relative;
          width: 100%;
        }

        .chat-header {
          padding: 12px 16px;
          border-bottom: 1px solid var(--border);
          background: var(--card);
          display: flex;
          justify-content: space-between;
          align-items: center;
          transition: var(--transition);
        }

        .chat-title {
          display: flex;
          align-items: center;
          gap: 10px;
        }

        .logo {
          font-size: 22px;
        }

        .name {
          font-weight: 700;
          font-size: 18px;
        }

        .subtitle {
          font-size: 13px;
          color: var(--muted);
          margin-top: 2px;
        }

        .welcome {
          display: grid;
          place-items: center;
          padding: 24px;
          text-align: center;
          align-content: start; /* Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ù„Ø£Ø¹Ù„Ù‰ */
        }

        .welcome h1 {
          font-size: 2rem;
          margin-bottom: 16px;
        }

        .welcome h1 span {
          color: var(--brand);
        }

        .suggestions {
          display: flex;
          gap: 8px;
          flex-wrap: wrap;
          justify-content: center;
          margin-top: 20px;
          max-width: 600px;
          width: 100%;
        }

        .chip {
          background: var(--bg);
          border: 1px solid var(--border);
          padding: 10px 16px;
          border-radius: 999px;
          cursor: pointer;
          transition: var(--transition);
          font-size: 14px;
          color: white;
          flex: 1 1 120px; /* ØªØ­Ø³ÙŠÙ† Ù…Ø±ÙˆÙ†Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        }

        .chip:hover {
          border-color: var(--brand);
          color: var(--brand);
          transform: translateY(-5px);
        }

        .chip.selected {
          background: var(--brand);
          border-color: var(--brand);
          color: var(--send-btn-text);
        }

        .levels {
          display: flex;
          gap: 8px;
          flex-wrap: wrap;
          justify-content: center;
          margin: 16px 0;
          max-width: 600px;
          width: 100%;
        }

        .levels button {
          background: var(--bg);
          border: 1px solid var(--border);
          padding: 10px 16px;
          border-radius: 999px;
          cursor: pointer;
          transition: var(--transition);
          color: var(--text);
          font-size: 14px;
          flex: 1 1 100px; /* ØªØ­Ø³ÙŠÙ† Ù…Ø±ÙˆÙ†Ø© Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø³ØªÙˆÙ‰ */
        }

        .levels button:hover {
          border-color: var(--brand);
          color: var(--brand);
        }

        .levels button.selected {
          background: var(--brand);
          border-color: var(--brand);
          color: var(--send-btn-text);
        }

        /* === Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø© === */
        .chat {
          overflow: auto;
          padding: 16px;
          display: flex;
          flex-direction: column;
          gap: 16px;
          scroll-behavior: smooth;
          width: 100%;
        }

        .msg {
          display: grid;
          grid-template-columns: 36px auto 1fr;
          gap: 12px;
          align-items: flex-start;
          width: 100%;
          max-width: 900px;
          margin: 0 auto;
          animation: fadeIn 0.3s ease;
        }

        .msg.user {
          direction: ltr;
        }

        .msg.user .bubble-container {
          grid-column: 2 / span 2;
          direction: rtl;
        }

        .msg.bot .bubble-container {
          grid-column: 1 / span 2;
          direction: rtl;
        }

        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }

        .msg .avatar {
          width: 36px;
          height: 36px;
          border-radius: 50%;
          display: grid;
          place-items: center;
          background: var(--bg);
          border: 1px solid var(--border);
          font-size: 16px;
          flex-shrink: 0;
        }

        .msg.user .avatar {
          background: var(--brand);
          color: var(--send-btn-text);
          border: none;
          grid-column: 1;
        }

        .msg.bot .avatar {
          grid-column: 1;
        }

        .bubble-container {
          display: flex;
          flex-direction: column;
          position: relative;
        }

        .msg .bubble {
          background: var(--bot-bubble);
          border: 1px solid var(--border);
          padding: 12px 16px;
          border-radius: 18px;
          white-space: pre-wrap;
          word-wrap: break-word;
          line-height: 1.5;
          max-width: 100%;
          flex: 1;
        }

        .msg.user .bubble {
          background: var(--user-bubble);
        }

        /* Ø²Ø± Ø§Ù„Ù†Ø³Ø® Ù„ÙƒÙ„ Ø±Ø³Ø§Ù„Ø© - Ù…Ø­Ø³Ù‘Ù† */
        .copy-btn {
          background: transparent;
          border: 1px solid var(--border);
          color: var(--muted);
          padding: 4px 8px;
          border-radius: 6px;
          cursor: pointer;
          transition: var(--transition);
          font-size: 11px;
          margin-top: 4px;
          align-self: flex-start;
          opacity: 0.7;
        }

        .msg:hover .copy-btn {
          opacity: 1;
        }

        .copy-btn:hover {
          border-color: var(--brand);
          color: var(--brand);
          background: rgba(34, 211, 238, 0.1);
        }

        .copy-btn.copied {
          background: var(--success);
          border-color: var(--success);
          color: white;
        }

        .typing-indicator {
          display: inline-flex;
          gap: 4px;
          padding: 8px 0;
        }

        .typing-dot {
          width: 6px;
          height: 6px;
          border-radius: 50%;
          background-color: var(--muted);
          animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingAnimation {
          0%, 60%, 100% { transform: translateY(0); }
          30% { transform: translateY(-5px); }
        }

        /* === Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø© === */
        .composer {
          position: sticky;
          bottom: 0;
          background: linear-gradient(to top, var(--bg) 70%, transparent);
          padding: 16px;
          border-top: 1px solid var(--border);
          transition: var(--transition);
          width: 100%;
        }

        .input-wrap {
          display: grid;
          grid-template-columns: auto 1fr;
          gap: 8px;
          align-items: end;
          width: min(900px, 100%);
          margin: 0 auto;
          background: var(--card);
          border: 1px solid var(--border);
          border-radius: 14px;
          padding: 12px;
          transition: var(--transition);
        }

        .input-wrap:focus-within {
          border-color: var(--brand);
          box-shadow: 0 0 0 2px rgba(34, 211, 238, 0.1);
        }

        textarea {
          width: 100%;
          resize: none;
          max-height: 32svh;
          background: transparent;
          color: var(--text);
          border: none;
          outline: none;
          font-size: 15px;
          font-family: inherit;
          line-height: 1.5;
          direction: rtl;
          padding: 8px 0;
        }

        .controls {
          display: flex;
          gap: 8px;
          align-items: center;
        }

        /* Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø­Ø³Ù† - ÙÙŠ Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠØ³Ø± */
        .send-btn {
          background: var(--send-btn-bg);
          border: 1px solid var(--send-btn-bg);
          color: var(--send-btn-text);
          padding: 10px 16px;
          border-radius: 10px;
          cursor: pointer;
          transition: var(--transition);
          font-family: inherit;
          font-size: 14px;
          font-weight: 600;
          min-width: 80px;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 6px;
          order: -1; /* Ù†Ù‚Ù„ Ø§Ù„Ø²Ø± Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (Ø§Ù„ÙŠØ³Ø§Ø±) */
        }

        .send-btn:hover {
          background: var(--send-btn-hover);
          border-color: var(--send-btn-hover);
          transform: translateY(-1px);
        }

        .send-btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
          transform: none;
        }

        .btn {
          border: 1px solid var(--border);
          background: var(--bg);
          color: var(--text);
          padding: 8px 12px;
          border-radius: 10px;
          cursor: pointer;
          transition: var(--transition);
          font-family: inherit;
          font-size: 14px;
        }

        .btn:hover {
          border-color: var(--brand);
          color: var(--brand);
        }

        .btn.primary {
          background: var(--brand);
          border-color: var(--brand);
          color: var(--send-btn-text);
        }

        .btn.primary:hover {
          background: var(--send-btn-hover);
          border-color: var(--send-btn-hover);
        }

        .btn.ghost {
          background: transparent;
        }

        .btn.full {
          width: 100%;
        }

        .icon-btn {
          height: 36px;
          width: 36px;
          display: grid;
          place-items: center;
          border-radius: 10px;
          border: 1px solid var(--border);
          background: var(--bg);
          cursor: pointer;
          transition: var(--transition);
        }

        .icon-btn:hover {
          border-color: var(--brand);
          color: var(--brand);
        }

        .tos {
          width: min(900px, 100%);
          margin: 12px auto 0;
          color: var(--muted);
          font-size: 12px;
          text-align: center;
        }

        /* === ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­ === */
        body.theme-light {
          --bg: #f8fafc;
          --text: #1e293b;
          --muted: #64748b;
          --card: #ffffff;
          --border: #e2e8f0;
          --brand: #0ea5e9;
          --user-bubble: #e0f2fe;
          --bot-bubble: #f1f5f9;
          --send-btn-bg: #0ea5e9;
          --send-btn-text: #ffffff;
          --send-btn-hover: #0284c7;
        }

        body.theme-light .sidebar {
          border-inline-end: 1px solid var(--border);
        }

        body.theme-light .btn.primary,
        body.theme-light .send-btn,
        body.theme-light .chip.selected,
        body.theme-light .levels button.selected {
          color: #ffffff !important;
        }

        /* === ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ© === */
        
        /* Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù„ÙˆØ­ÙŠØ© (768px ÙØ£Ù‚Ù„) */
        @media (max-width: 768px) {
          #app {
            grid-template-columns: 1fr;
          }
       
          .sidebar {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 280px;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
          }
       
          .sidebar.open {
            transform: translateX(0);
          }
       
          .sidebar-overlay {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
          }
       
          .sidebar-overlay.open {
            display: block;
          }
       
          .mobile-menu-btn {
            display: block;
            position: fixed;
            top: 16px;
            right: 16px;
            z-index: 1001;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 18px;
          }

          .msg {
            grid-template-columns: 32px auto 1fr;
            gap: 8px;
          }

          .msg .avatar {
            width: 32px;
            height: 32px;
            font-size: 14px;
          }

          .copy-btn {
            opacity: 1;
            padding: 4px 6px;
            font-size: 10px;
          }

          .chat-header {
            padding: 10px 12px;
          }

          .name {
            font-size: 16px;
          }

          .subtitle {
            font-size: 12px;
          }

          .welcome h1 {
            font-size: 1.5rem;
          }

          .suggestions {
            gap: 6px;
          }

          .chip {
            padding: 8px 12px;
            font-size: 13px;
          }

          .input-wrap {
            grid-template-columns: auto 1fr;
            gap: 8px;
          }

          .send-btn {
            padding: 8px 14px;
            min-width: 70px;
            font-size: 13px;
          }
        }

        /* Ù„Ù„Ù‡ÙˆØ§ØªÙ Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø© (480px ÙØ£Ù‚Ù„) */
        @media (max-width: 480px) {
          .main {
            grid-template-rows: auto 1fr auto;
          }

          .chat {
            padding: 12px;
            gap: 12px;
          }

          .msg {
            grid-template-columns: 28px auto 1fr;
            gap: 6px;
          }

          .msg .avatar {
            width: 28px;
            height: 28px;
            font-size: 12px;
          }

          .msg .bubble {
            padding: 10px 12px;
            font-size: 14px;
          }

          .copy-btn {
            padding: 3px 5px;
            font-size: 9px;
          }

          .composer {
            padding: 12px;
          }

          .input-wrap {
            grid-template-columns: auto 1fr;
            gap: 6px;
            padding: 10px;
          }

          .send-btn {
            padding: 8px 12px;
            min-width: 60px;
            font-size: 12px;
          }

          .controls {
            flex-direction: column;
            gap: 4px;
          }

          .welcome {
            padding: 16px;
          }

          .welcome h1 {
            font-size: 1.3rem;
            margin-bottom: 12px;
          }

          .suggestions, .levels {
            flex-direction: column;
            align-items: stretch;
            gap: 6px;
          }

          .chip, .levels button {
            width: 100%;
            text-align: center;
          }

          .mobile-menu-btn {
            top: 12px;
            right: 12px;
            padding: 6px 10px;
            font-size: 16px;
          }

          .sidebar {
            width: 100%;
          }
        }

        /* Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ (1200px ÙÙ…Ø§ ÙÙˆÙ‚) */
        @media (min-width: 1200px) {
          .msg {
            max-width: 1000px;
          }

          .input-wrap {
            max-width: 1000px;
          }
        }

        /* Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ (360px ÙØ£Ù‚Ù„) */
        @media (max-width: 360px) {
          .input-wrap {
            grid-template-columns: auto 1fr;
            gap: 8px;
          }

          .send-btn {
            min-width: auto;
          }

          .chat-header {
            flex-direction: column;
            gap: 8px;
            text-align: center;
          }

          .welcome h1 {
            font-size: 1.1rem;
          }
        }

        /* Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙÙ‚ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ */
        @media (max-height: 500px) and (orientation: landscape) {
          .main {
            grid-template-rows: auto 1fr auto;
          }

          .chat-header {
            padding: 8px 12px;
          }

          .chat {
            padding: 8px 12px;
            gap: 8px;
          }

          .composer {
            padding: 8px 12px;
          }

          .input-wrap {
            padding: 8px;
          }

          .send-btn {
            padding: 6px 10px;
          }
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
        .loading {
          opacity: 0.7;
          pointer-events: none;
        }

        .notification {
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          background: var(--card);
          border: 1px solid var(--border);
          border-radius: 8px;
          padding: 12px 16px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
          z-index: 1000;
          display: flex;
          align-items: center;
          gap: 8px;
          animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
          from { opacity: 0; transform: translate(-50%, 20px); }
          to { opacity: 1; transform: translate(-50%, 0); }
        }

        .notification.success {
          border-color: var(--success);
        }

        .notification.error {
          border-color: var(--error);
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù…Ø®ØµØµ */
        .chat::-webkit-scrollbar {
          width: 6px;
        }

        .chat::-webkit-scrollbar-track {
          background: transparent;
        }

        .chat::-webkit-scrollbar-thumb {
          background: var(--border);
          border-radius: 3px;
        }

        .chat::-webkit-scrollbar-thumb:hover {
          background: var(--muted);
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ */
        @media (prefers-reduced-motion: reduce) {
          * {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
          }
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¹Ø±ÙŠØ¶Ø© */
        @media (min-width: 1400px) {
          .msg {
            max-width: 1100px;
          }
          
          .input-wrap {
            max-width: 1100px;
          }
        }
    </style>
</head>
<body class="theme-dark">
    <div id="app">
        <button id="mobile-menu-btn" class="mobile-menu-btn" aria-label="ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©" style="display: none;">
            <span>â˜°</span>
        </button>
      
        <div id="sidebar-overlay" class="sidebar-overlay"></div>
      
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-top">
                <button id="new-chat" class="btn primary full">
                    <span>+</span> Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©
                </button>
            </div>
            <nav class="history" id="history-list">
                <div class="history-empty" id="history-empty">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø¨Ø¹Ø¯</div>
                </nav>
            <div class="sidebar-bottom">
                <button id="toggle-theme" class="btn ghost full">
                    <span id="theme-icon">ğŸŒ™</span> ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¸Ù‡Ø±
                </button>
                <div class="brand">LUKU AI</div>
            </div>
        </aside>

        <main class="main">
            <header class="chat-header">
                <div class="chat-title">
                    <span class="logo">ğŸ§©</span>
                    <div>
                        <div class="name">LUKU AI</div>
                        <div class="subtitle">Ù…Ø®ØªØµ ÙÙŠ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ ÙˆØ§Ù„Ø£Ù„ØºØ§Ø² ÙÙ‚Ø·</div>
                    </div>
                </div>
                <button id="clear-chat" class="btn ghost" aria-label="Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©">
                    ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
                </button>
            </header>

            <section id="welcome" class="welcome">
                <h1>Ù…Ø±Ø­Ø¨Ù‹Ø§! ğŸ‘‹ Ø£Ù†Ø§ <span>LUKU AI</span></h1>
                <p class="hint">Ø§Ø®ØªØ± Ù…Ø¬Ø§Ù„ Ø§Ù„Ø£Ù„ØºØ§Ø² Ø£ÙˆÙ„Ø§Ù‹:</p>
                <div class="suggestions">
                    <button class="chip" data-category="Ø¯ÙŠÙ†">ğŸ•Œ Ø¯ÙŠÙ†</button>
                    <button class="chip" data-category="Ø±ÙŠØ§Ø¶Ø©">âš½ Ø±ÙŠØ§Ø¶Ø©</button>
                    <button class="chip" data-category="Ø«Ù‚Ø§ÙØ©">ğŸ“š Ø«Ù‚Ø§ÙØ©</button>
                    <button class="chip" data-category="Ù…Ù†Ø·Ù‚">ğŸ”¢ Ù…Ù†Ø·Ù‚</button>
                    <button class="chip" data-category="ØªØ±ÙÙŠÙ‡">ğŸ­ ØªØ±ÙÙŠÙ‡</button>
                </div>
            </section>

            <section id="chat" class="chat" aria-live="polite"></section>

            <footer class="composer">
                <div class="input-wrap">
                    <div class="controls">
                        <button id="send" class="send-btn">
                            <span>ğŸš€</span>
                            <span>Ø¥Ø±Ø³Ø§Ù„</span>
                        </button>
                    </div>
                    <textarea id="input" rows="1" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒâ€¦ (Enter Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ / Shift+Enter Ù„Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯)" aria-label="Ø±Ø³Ø§Ù„ØªÙƒ"></textarea>
                </div>
                <div class="tos">Â© 2025 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© â€” <strong>Luai Kulaib</strong></div>
            </footer>
        </main>
    </div>

    <div id="notification-area"></div>

    <script>
        // === Ø¥Ù†Ø´Ø§Ø¡ Ø£Ùˆ ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (UserId) ===
        function getUserId() {
            let userId = localStorage.getItem('luku_user_id');
            if (!userId) {
                // ØªÙˆÙ„ÙŠØ¯ Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                userId = 'user_' + Date.now() + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('luku_user_id', userId);
            }
            return userId;
        }

        // === Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ===
        const state = {
            userId: getUserId(),
            currentSessionId: null,
            selectedCategory: null,
            selectedLevel: null,
            isWaitingForResponse: false,
            theme: localStorage.getItem('luku-theme') || 'dark'
        };

        // === Ø¹Ù†Ø§ØµØ± DOM ===
        const elements = {
            chatBox: document.getElementById("chat"),
            welcomeSection: document.getElementById("welcome"),
            input: document.getElementById("input"),
            sendBtn: document.getElementById("send"),
            suggestions: document.querySelectorAll(".chip"),
            historyList: document.getElementById("history-list"),
            historyEmpty: document.getElementById("history-empty"),
            newChatBtn: document.getElementById("new-chat"),
            toggleThemeBtn: document.getElementById("toggle-theme"),
            themeIcon: document.getElementById("theme-icon"),
            clearChatBtn: document.getElementById("clear-chat"),
            mobileMenuBtn: document.getElementById("mobile-menu-btn"),
            sidebar: document.getElementById("sidebar"),
            sidebarOverlay: document.getElementById("sidebar-overlay"),
            notificationArea: document.getElementById("notification-area")
        };

        // === ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ===
        function showNotification(message, type = 'info', duration = 3000) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            let icon = 'ğŸ’¡';
            if (type === 'success') icon = 'âœ…';
            if (type === 'error') icon = 'âŒ';
            notification.innerHTML = `
                <span>${icon}</span>
                <span>${message}</span>
            `;
            elements.notificationArea.appendChild(notification);
            setTimeout(() => {
                notification.remove();
            }, duration);
        }

        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                showNotification('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ù†Øµ', 'error');
            });
        }

        function toggleMobileMenu() {
            elements.sidebar.classList.toggle('open');
            elements.sidebarOverlay.classList.toggle('open');
            document.body.style.overflow = elements.sidebar.classList.contains('open') ? 'hidden' : '';
        }
        
        // --- ÙˆØ¸ÙŠÙØ© Ø¬Ø¯ÙŠØ¯Ø©: Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© Ø¹Ø¨Ø± /start_session ---
        async function startNewSession(category, level) {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù†Ù†Ø§ Ù„Ø³Ù†Ø§ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø±Ø¯
            if (state.isWaitingForResponse) return;
            state.isWaitingForResponse = true;
            elements.sendBtn.disabled = true;

            // Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„ØªØ±Ø­ÙŠØ¨ ÙˆØ§Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
            elements.welcomeSection.style.display = 'none';
            clearChat();

            state.selectedCategory = category;
            state.selectedLevel = level;
            state.currentSessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;

            showTypingIndicator();
            showNotification(`Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± ØªØ­Ø¯ÙŠ ${category} Ø¨Ù…Ø³ØªÙˆÙ‰ ${level}... ğŸ¯`, 'info');

            try {
                const response = await fetch('/start_session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: state.userId,
                        category: category,
                        level: level,
                    })
                });

                const data = await response.json();

                if (data.success) {
                    hideTypingIndicator();
                    addMessage(data.reply, 'bot');
                    addSessionToHistory(state.currentSessionId, category, level, data.character);
                    showNotification('Ø¨Ø¯Ø£Øª Ø§Ù„Ù„Ø¹Ø¨Ø©! Ù‡ÙŠØ§ Ù†Ù„Ø¹Ø¨! ğŸš€', 'success');
                } else {
                    throw new Error(data.message || 'ÙØ´Ù„ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©');
                }

            } catch (error) {
                console.error('Error starting session:', error);
                hideTypingIndicator();
                addMessage(`âŒ Ø¹Ø°Ø±Ø§Ù‹! Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙ†ÙŠ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ÙØªØ§Ø­ Gemini API Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­. ${error.message}`, 'bot');
                showNotification('ÙØ´Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©', 'error');
                // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ÙØ´Ù„ Ù†ÙØ¹ÙŠØ¯ Ø¸Ù‡ÙˆØ± Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ù„ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø¬Ø¯Ø¯Ø§Ù‹
                showWelcomeScreen();
            } finally {
                state.isWaitingForResponse = false;
                elements.sendBtn.disabled = false;
            }
        }

        function addSessionToHistory(sessionId, category, level, characterName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø§Øª"
            elements.historyEmpty.style.display = 'none';
          
            // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item active'; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø©
            historyItem.dataset.sessionId = sessionId;
            
            // Ø¥Ø²Ø§Ù„Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø· Ù…Ù† Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¹Ù†Ø§ØµØ±
            document.querySelectorAll('.history-item').forEach(item => item.classList.remove('active'));
          
            historyItem.innerHTML = `
                <div class="history-item-title">${characterName}</div>
                <div class="history-item-preview">${category} - ${level}</div>
            `;
          
            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„Ù†Ù‚Ø±
            historyItem.addEventListener('click', () => {
                loadSession(sessionId); // Ø­Ø§Ù„ÙŠØ§Ù‹ Ù‡Ø°Ù‡ ÙˆØ¸ÙŠÙØ© Ù…Ø­Ø§ÙƒØ§Ø©
            });
          
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù„Ù‰
            elements.historyList.prepend(historyItem);
        }

        function loadSession(sessionId) {
             // (Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ Ù…Ø¬Ø±Ø¯ Ù…Ø­Ø§ÙƒØ§Ø©ØŒ ÙŠÙ…ÙƒÙ† ØªØ·ÙˆÙŠØ±Ù‡Ø§ Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹ Ù„ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…)
            showNotification('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©...', 'info');
            state.currentSessionId = sessionId;
            document.querySelectorAll('.history-item').forEach(item => item.classList.remove('active'));
            document.querySelector(`[data-session-id="${sessionId}"]`).classList.add('active');
            
            clearChat();
            addMessage('Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ Ù…Ø¬Ø¯Ø¯Ù‹Ø§! Ø§Ù„Ø¬Ù„Ø³Ø© Ù„Ù… ØªÙØ­ÙØ¸ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ø¹Ø¯. Ø§Ø·Ù„Ø¨ Ù„ØºØ²Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹!', 'bot');
            showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© (Ù…Ø­Ø§ÙƒØ§Ø©)', 'success');
        }

        function clearChat() {
            elements.chatBox.innerHTML = '';
        }

        function clearAllChats() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª? Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.')) {
                elements.historyList.innerHTML = '';
                elements.historyEmpty.style.display = 'block';
                clearChat();
                state.currentSessionId = null;
                showWelcomeScreen();
                showNotification('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª', 'success');
            }
        }
        
        function showWelcomeScreen() {
             // Ø¥Ø¹Ø§Ø¯Ø© Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø¥Ù„Ù‰ Ø­Ø§Ù„ØªÙ‡Ø§ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
            elements.welcomeSection.style.display = 'grid';
            elements.welcomeSection.querySelector('.hint').textContent = 'Ø§Ø®ØªØ± Ù…Ø¬Ø§Ù„ Ø§Ù„Ø£Ù„ØºØ§Ø² Ø£ÙˆÙ„Ø§Ù‹:';
            elements.welcomeSection.querySelector('.suggestions').style.display = 'flex';
          
            const levelsSection = elements.welcomeSection.querySelector('.levels');
            if (levelsSection) {
                levelsSection.remove();
            }
          
            // Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            elements.suggestions.forEach(b => b.classList.remove('selected'));
        }

        // === Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ===
        function addMessage(text, sender = 'bot') {
            const msgDiv = document.createElement('div');
            msgDiv.className = `msg ${sender}`;
          
            const avatar = sender === 'bot' ? 'ğŸ§©' : 'ğŸ‘¤';
          
            msgDiv.innerHTML = `
                <div class="avatar">${avatar}</div>
                <div class="bubble-container">
                    <div class="bubble">${text}</div>
                    ${sender === 'bot' ? '<button class="copy-btn" title="Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø©">ğŸ“‹ Ù†Ø³Ø®</button>' : ''}
                </div>
            `;
          
            elements.chatBox.appendChild(msgDiv);
            elements.chatBox.scrollTop = elements.chatBox.scrollHeight;

            // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø§Ù„Ù†Ø³Ø® Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¨ÙˆØª ÙÙ‚Ø·
            if (sender === 'bot') {
                const copyBtn = msgDiv.querySelector('.copy-btn');
                copyBtn.addEventListener('click', () => {
                    const messageText = msgDiv.querySelector('.bubble').textContent;
                    copyToClipboard(messageText);
                    
                    // ØªØºÙŠÙŠØ± Ù…Ø¸Ù‡Ø± Ø§Ù„Ø²Ø± Ù…Ø¤Ù‚ØªØ§Ù‹ Ù„Ù„Ø¥Ø´Ø§Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø³Ø®
                    copyBtn.textContent = 'âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®';
                    copyBtn.classList.add('copied');
                    setTimeout(() => {
                        copyBtn.textContent = 'ğŸ“‹ Ù†Ø³Ø®';
                        copyBtn.classList.remove('copied');
                    }, 2000);
                });
            }
        }

        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'msg bot';
            typingDiv.id = 'typing-indicator';
          
            typingDiv.innerHTML = `
                <div class="avatar">ğŸ§©</div>
                <div class="bubble-container">
                    <div class="bubble">
                        <div class="typing-indicator">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                </div>
            `;
          
            elements.chatBox.appendChild(typingDiv);
            elements.chatBox.scrollTop = elements.chatBox.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // === Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù… Ø¹Ø¨Ø± /chat ===
        async function sendMessage() {
            const text = elements.input.value.trim();
            if (!text || state.isWaitingForResponse) return;
          
            // ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ø¬Ù„Ø³Ø© Ù‚Ø¯ Ø¨Ø¯Ø£Øª
            if (!state.currentSessionId) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø³Ù… ÙˆØ§Ù„Ù…Ø³ØªÙˆÙ‰ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„Ø¨Ø¯Ø¡.', 'warning');
                return;
            }
          
            // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            addMessage(text, 'user');
            elements.input.value = '';
            autoResizeTextarea(elements.input);
          
            showTypingIndicator();
            state.isWaitingForResponse = true;
            elements.sendBtn.disabled = true;

            try {
                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… Ø¹Ø¨Ø± Ø§Ù„Ù…Ø³Ø§Ø± /chat
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: text,
                        userId: state.userId,
                        sessionId: state.currentSessionId,
                        category: state.selectedCategory || 'Ø¹Ø§Ù…',
                        level: state.selectedLevel || 'Ø³Ù‡Ù„',
                    })
                });
              
                const data = await response.json();
              
                if (data.error) {
                    throw new Error(data.message);
                }
              
                // Ø¥Ø¶Ø§ÙØ© Ø±Ø¯ Ø§Ù„Ø¨ÙˆØª
                hideTypingIndicator();
                addMessage(data.reply, 'bot');
              
            } catch (error) {
                console.error('Error communicating with server:', error);
                hideTypingIndicator();
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'error');
                addMessage(`âŒ Ø¹Ø°Ø±Ø§Ù‹! Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ØªÙØ§ØµÙŠÙ„: ${error.message}.`, 'bot');
            } finally {
                state.isWaitingForResponse = false;
                elements.sendBtn.disabled = false;
            }
        }

        // === Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¸Ù‡Ø± ===
        function toggleTheme() {
            if (state.theme === 'dark') {
                document.body.classList.add('theme-light');
                document.body.classList.remove('theme-dark');
                elements.themeIcon.textContent = 'â˜€ï¸';
                state.theme = 'light';
                localStorage.setItem('luku-theme', 'light');
                showNotification('ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­', 'success');
            } else {
                document.body.classList.add('theme-dark');
                document.body.classList.remove('theme-light');
                elements.themeIcon.textContent = 'ğŸŒ™';
                state.theme = 'dark';
                localStorage.setItem('luku-theme', 'dark');
                showNotification('ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†', 'success');
            }
        }

        function loadTheme() {
            if (state.theme === 'light') {
                document.body.classList.add('theme-light');
                document.body.classList.remove('theme-dark');
                elements.themeIcon.textContent = 'â˜€ï¸';
            }
        }

        // === Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ø´Ø§Ø´Ø© ===
        function checkScreenSize() {
            if (window.innerWidth <= 768) {
                elements.mobileMenuBtn.style.display = 'block';
                elements.sidebar.classList.remove('open');
                elements.sidebarOverlay.classList.remove('open');
            } else {
                elements.mobileMenuBtn.style.display = 'none';
                elements.sidebar.classList.remove('open');
                elements.sidebarOverlay.classList.remove('open');
                document.body.style.overflow = '';
            }
        }

        // === ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ===
        function setupEventListeners() {
            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
            elements.sendBtn.addEventListener('click', sendMessage);
            elements.input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
                setTimeout(() => autoResizeTextarea(elements.input), 0);
            });
            elements.input.addEventListener('input', () => {
                autoResizeTextarea(elements.input);
            });
          
            // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¬Ø§Ù„
            elements.suggestions.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Ø¥Ø°Ø§ ÙƒÙ†Ø§ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø±Ø¯ØŒ Ù†Ù…Ù†Ø¹ Ø§Ù„ØªØºÙŠÙŠØ±
                    if (state.isWaitingForResponse) return;

                    // Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
                    elements.suggestions.forEach(b => b.classList.remove('selected'));
                    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø²Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
                    btn.classList.add('selected');
                  
                    state.selectedCategory = btn.dataset.category;
                  
                    // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ù‚Ø§Ø¦Ù…Ø© Ù…Ø³ØªÙˆÙŠØ§Øª Ø³Ø§Ø¨Ù‚Ø©
                    const existingLevels = elements.welcomeSection.querySelector('.levels');
                    if (existingLevels) {
                        existingLevels.remove();
                    }
                  
                    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªÙˆÙ‰
                    elements.welcomeSection.querySelector('.hint').textContent = 'Ø§Ø®ØªØ± Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©:';
                    elements.welcomeSection.querySelector('.suggestions').style.display = 'flex';
                  
                    const levelsHtml = `
                        <div class="levels">
                            <button data-level="Ø³Ù‡Ù„" class="chip">Ø³Ù‡Ù„ ğŸŒ±</button>
                            <button data-level="Ù…ØªÙˆØ³Ø·" class="chip">Ù…ØªÙˆØ³Ø· ğŸ’¡</button>
                            <button data-level="ØµØ¹Ø¨" class="chip">ØµØ¹Ø¨ ğŸ¤¯</button>
                        </div>
                    `;
                  
                    elements.welcomeSection.insertAdjacentHTML('beforeend', levelsHtml);
                  
                    // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„ØµØ¹ÙˆØ¨Ø©
                    document.querySelectorAll('.levels .chip').forEach(levelBtn => {
                        levelBtn.addEventListener('click', () => {
                            // Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª
                            document.querySelectorAll('.levels .chip').forEach(b => b.classList.remove('selected'));
                            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø²Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
                            levelBtn.classList.add('selected');
                          
                            state.selectedLevel = levelBtn.dataset.level;
                            // ğŸš€ Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                            startNewSession(state.selectedCategory, state.selectedLevel);
                        });
                    });
                });
            });
          
            // Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø®Ø±Ù‰
            elements.newChatBtn.addEventListener('click', () => {
                state.currentSessionId = null; // Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ù†Ø·Ù‚ÙŠØ§Ù‹
                showWelcomeScreen();
                clearChat();
                showNotification('ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©', 'success');
            });
          
            elements.toggleThemeBtn.addEventListener('click', toggleTheme);
          
            elements.clearChatBtn.addEventListener('click', clearAllChats);
          
            // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø©
            elements.mobileMenuBtn.addEventListener('click', toggleMobileMenu);
            elements.sidebarOverlay.addEventListener('click', toggleMobileMenu);
          
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ø´Ø§Ø´Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø¬Ù…
            window.addEventListener('load', checkScreenSize);
            window.addEventListener('resize', checkScreenSize);
        }

        // === ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ===
        function initApp() {
            loadTheme();
            setupEventListeners();
            autoResizeTextarea(elements.input);
            checkScreenSize();
          
            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
            const welcomeMessages = [
                "Ù…Ø±Ø­Ø¨Ù‹Ø§! ğŸ‘‹ Ø£Ù†Ø§ LUKU AI",
                "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ! ğŸ‘‹ Ø£Ù†Ø§ LUKU AI",
                "Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ LUKU AI! ğŸ‘‹",
            ];
          
            const randomIndex = Math.floor(Math.random() * welcomeMessages.length);
            document.querySelector('.welcome h1').innerHTML = `${welcomeMessages[randomIndex]} <span>LUKU AI</span>`;
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯Ù…Ø§ ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
